---
title: Analysis of Potential Data Problems in Pittsburgh Police Incident Blotter Archive
author: Conor Tompkins
date: '2017-10-11'
slug: analysis-of-potential-data-problems-in-pittsburgh-police-incident-blotter-archive
categories:
  - Pittsburgh
  - R
tags:
  - Crime
  - Pittsburgh
  - WPRDC
  - R Markdown
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Last updated: `r paste(Sys.time())`

This is an analysis of potential data problems in the Pittsburgh Police Incident Blotter Archive.

These are the R packages used in this analysis:

```{r load libraries, message=FALSE, warning=FALSE}
library(rmarkdown)
library(knitr)
library(tidyverse)
library(lubridate)
library(viridis)
library(ggmap)
library(scales)
```

Refer to the Exploratory Analysis file on my GitHub page for an intro on working with this data

[http://ctompkins.netlify.com/2017/10/07/pittsburgh-crime-data/]

```{r read data into r, echo=FALSE, message=FALSE, warning=FALSE}
df <- read_csv("https://raw.githubusercontent.com/conorotompkins/pgh-crime/master/archive-police-blotter.csv")
```


```{r lower case column names, echo=FALSE, message=FALSE, warning=FALSE}
colnames(df) <- tolower(colnames(df))
```

```{r rename columnn names, echo=FALSE, message=FALSE, warning=FALSE}
df <- df %>% 
  rename(date_time = incidenttime,
         location = incidentlocation,
         cleared_flag = clearedflag,
         neighborhood = incidentneighborhood,
         zone = incidentzone,
         description = hierarchydesc,
         tract = incidenttract)
```


```{r lubridate column names, echo=FALSE, message=FALSE, warning=FALSE}
df <- df %>%
  mutate(date_time = mdy_hm(date_time),
         date = ymd(substr(date_time, 1, 10)),
         year = year(date),
         month = month(date, label = TRUE),
         wday = wday(date, label = TRUE),
         mday = mday(date))
```         

```{r reorder column names, echo=FALSE, message=FALSE, warning=FALSE}
df <- df %>% 
  select(date, 
         year,
         month,
         wday,
         mday,
         location,
         neighborhood,
         zone,
         description,
         cleared_flag,
         x,
         y)
```        

#Zone reporting consistency

Does the Zone the incident is assigned to match the geolocations the incident is reported at?

```{r create city map 11, message=FALSE, warning=FALSE}
city_map_11 <-  get_map(location = "Oakland, Pittsburgh, PA",
               zoom = 11,
               maptype = "toner", 
               source = "stamen",
               messaging = FALSE)

city_map_11 <- ggmap(city_map_11)
```

```{r create zone map df}
df_map_zones <- df %>% 
  filter(zone %in% c(1:6)) %>% 
  select(zone, x, y) %>% 
  mutate(zone = as.factor(paste("Zone:", zone)))
```

In this view, the data looks accurate
```{r create zone map}
city_map_11 +
  geom_point(data = df_map_zones, aes(x, y, color = as.factor(zone)), alpha = .3, size = .7, show.legend = FALSE) +
  scale_color_viridis(discrete = TRUE) +
  labs(title = "Pittsburgh Police Incident Data",
       x = NULL,
       y = NULL) +
  theme(legend.position = "bottom",
        legend.direction = "horizontal",
        axis.text = element_blank())
```